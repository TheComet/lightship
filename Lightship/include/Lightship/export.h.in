/* ----------------------------------------------------------------
 * Export and visibility amcros
 * ----------------------------------------------------------------
 * Substitution variables:
 *  - LIGHTSHIP_LIB_TYPE   : Set to either SHARED or STATIC.
 *  - LIGHTSHIP_PLATFORM   : Set to WINDOWS, OSX, LINUX, ANDROID, or IOS
 * Global definitions (non substitution)
 *  - LIGHTSHIP_BUILDING   : Define this if the library is being built.
 * ------------------------------------------------------------- */

#ifndef LIGHTSHIP_EXPORT_H
#   define LIGHTSHIP_EXPORT_H

    /* set @BUILD_TYPE@ to SHARED or STATIC */
#   define LIGHTSHIP_@LIGHTSHIP_LIB_TYPE@
#   define LIGHTSHIP_PLATFORM_@LIGHTSHIP_PLATFORM@

    /* --------------------------------------------------------------
     * define visibility macros
     * --------------------------------------------------------------*/

#   if !defined(LIGHTSHIP_SHARED) && !defined(LIGHTSHIP_STATIC)
#       error Please define LIGHTSHIP_SHARED or LIGHTSHIP_STATIC.
#   endif

    /* DLL platforms */
#   if defined(LIGHTSHIP_SHARED) && defined(LIGHTSHIP_PLATFORM_WINDOWS)
#       if defined(__GNUC__)
            /* cygwin visbibility */
#           define LIGHTSHIP_HELPER_API_EXPORT __attribute__ ((dllexport))
#           define LIGHTSHIP_HELPER_API_IMPORT __attribute__ ((dllimport))
#       else
            /* msvc visibility */
#           define LIGHTSHIP_HELPER_API_EXPORT __declspec(dllexport)
#           define LIGHTSHIP_HELPER_API_IMPORT __declspec(dllimport)
#       endif
#       define LIGHTSHIP_HELPER_PRIVATE_API

    /* Other platforms, just assume it's GCC/clang */
#   elif defined(LIGHTSHIP_SHARED) && defined(__GNUC__) && __GNUC__ >= 4
        /* gcc 4+ visibility */
#       define LIGHTSHIP_HELPER_API_EXPORT __attribute__ ((visibility ("default")))
#       define LIGHTSHIP_HELPER_API_IMPORT __attribute__ ((visibility ("default")))
#       define LIGHTSHIP_HELPER_PRIVATE_API  __attribute__ ((visibility ("hidden")))

    /*
     * All other cases:
     *   + gcc lower than 4 doesn't have any explicit visibility, everything is exported
     *   + static libs don't need visibility macros
     */
#   else
#       define LIGHTSHIP_HELPER_API_EXPORT
#       define LIGHTSHIP_HELPER_API_IMPORT
#       define LIGHTSHIP_HELPER_PRIVATE_API
#   endif

    /*
     * define public API macro, depending on whether the library is being
     * built or being linked against.
     */
#   if defined(LIGHTSHIP_BUILDING) /* defined by CMake when library is being compiled */
#       define LIGHTSHIP_PUBLIC_API LIGHTSHIP_HELPER_API_EXPORT
#   else
#       define LIGHTSHIP_PUBLIC_API LIGHTSHIP_HELPER_API_IMPORT
#   endif
#   define LIGHTSHIP_PRIVATE_API LIGHTSHIP_HELPER_PRIVATE_API

    /* --------------------------------------------------------------
     * Disable MSVC warnings
     * --------------------------------------------------------------*/

#   if defined(LIGHTSHIP_PLATFORM_WINDOWS) && !defined(__GNUC__)
#       pragma warning(disable: 4996) /* 'strcpy': This function or variable may be unsafe */
#   endif

    /* --------------------------------------------------------------
     * C linkage
     * --------------------------------------------------------------*/

#   ifdef __cplusplus
#       define C_HEADER_BEGIN extern "C" {
#   else
#       define C_HEADER_BEGIN
#   endif

#   ifdef __cplusplus
#       define C_HEADER_END }
#   else
#       define C_HEADER_END
#   endif

#endif /* LIGHTSHIP_EXPORT_H */
